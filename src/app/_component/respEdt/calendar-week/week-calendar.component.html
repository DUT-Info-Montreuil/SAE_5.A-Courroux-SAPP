<div id="calendar-container">
    <div id="cal-buttons">
        <div id="cal-date-nav-buttons" class="flex justify-between">
            <div>
                <button id="previous" mwlCalendarPreviousView [(viewDate)]="viewDate" [view]="view" [excludeDays]="[0, 6]" (click)="loadEvents()"
                class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-l ml-10 mt-10 mb-10"
                >Précédent</button>
                    
                <button id="today" mwlCalendarToday [(viewDate)]="viewDate" (click)="loadEvents()"
                class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 mt-10 mb-10"
                >Aujourd'hui</button>
                <button id="next" mwlCalendarNextView [(viewDate)]="viewDate" [view]="view" [excludeDays]="[0, 6]" (click)="loadEvents()"
                class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-r mr-10 mt-10 mb-10"
                >Prochain</button>
                <button 
                class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded"
                (click)="openModalAdd()"
                >Ajouter</button>

                <button 
                class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded ms-9"
                (click)="redirectToUtilitaires()"
                >Ajout utilitaires</button>

                <button 
                class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded ms-9"
                (click)="redirectToGestionGroupes()"
                >Eleves groupes</button>
            </div>

            <div>
                <button (click)="openModalStats()"
                class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded  mr-10 mt-10 mb-10"
               >Stats</button>
            </div>

            <div>
                <button (click)="openModalCopy()"
                 class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded  mr-10 mt-10 mb-10"
                >Copier</button>
                <button (click)="openModalPaste()"
                class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded  mr-10 mt-10 mb-10"
               >Coller</button>
                <button (click)="cancelCourse()"
                class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded  mr-10 mt-10 mb-10"
                >Annuler</button>
                <button (click)="publishCourse()"
                class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded mr-10 mt-10 mb-10"
                >Publier</button>
            </div>
            
        </div>
        
    </div>
    <ng-container *ngIf="!loading">
        <div class="ms-10">
            <select class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded w-52" (change)="changePromotion($event)" >
                <option *ngFor="let promo of promoManaged" [value]="promo.id">{{promo.group.name}}</option>
            </select>
        </div>
    <div class="w-full text-center items-center justify-center relative">
        
        <div class="text-center items-center justify-center ms-16 flex flex-col relative">
            
            <div class="flex flex-row gap-3">
                <h1 class="text-3xl font-semibold text-white py-3">Semaine {{getWeek(viewDate)}}</h1>
                <button  (click)="toggleModalComment()">
                    <svg *ngIf="getComment(viewDate)" width="30" height="30" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.49991 0.876892C3.84222 0.876892 0.877075 3.84204 0.877075 7.49972C0.877075 11.1574 3.84222 14.1226 7.49991 14.1226C11.1576 14.1226 14.1227 11.1574 14.1227 7.49972C14.1227 3.84204 11.1576 0.876892 7.49991 0.876892ZM1.82707 7.49972C1.82707 4.36671 4.36689 1.82689 7.49991 1.82689C10.6329 1.82689 13.1727 4.36671 13.1727 7.49972C13.1727 10.6327 10.6329 13.1726 7.49991 13.1726C4.36689 13.1726 1.82707 10.6327 1.82707 7.49972ZM8.24992 4.49999C8.24992 4.9142 7.91413 5.24999 7.49992 5.24999C7.08571 5.24999 6.74992 4.9142 6.74992 4.49999C6.74992 4.08577 7.08571 3.74999 7.49992 3.74999C7.91413 3.74999 8.24992 4.08577 8.24992 4.49999ZM6.00003 5.99999H6.50003H7.50003C7.77618 5.99999 8.00003 6.22384 8.00003 6.49999V9.99999H8.50003H9.00003V11H8.50003H7.50003H6.50003H6.00003V9.99999H6.50003H7.00003V6.99999H6.50003H6.00003V5.99999Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
                    <svg *ngIf="!getComment(viewDate)" width="30" height="30" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0.877075 7.49991C0.877075 3.84222 3.84222 0.877075 7.49991 0.877075C11.1576 0.877075 14.1227 3.84222 14.1227 7.49991C14.1227 11.1576 11.1576 14.1227 7.49991 14.1227C3.84222 14.1227 0.877075 11.1576 0.877075 7.49991ZM7.49991 1.82708C4.36689 1.82708 1.82708 4.36689 1.82708 7.49991C1.82708 10.6329 4.36689 13.1727 7.49991 13.1727C10.6329 13.1727 13.1727 10.6329 13.1727 7.49991C13.1727 4.36689 10.6329 1.82708 7.49991 1.82708Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
                </button>
            </div>
            <ng-container class="block" *ngIf="showModalComment">
                <comment-add [comment]="getComment(viewDate)" [date]="viewDate" [weekNumber]="getWeek(viewDate)" [promo]="promoSelected" (closeModal)="toggleModalComment()" (updateOrCreate)="addOrUpdateComment($event)" (remove)="deleteComment($event)"></comment-add>
            </ng-container>
        </div>
    </div>
    <mwl-calendar-week-view *ngIf="isWeekCalendar"
        [viewDate]="viewDate"
        class="week-view" 
        [events]="events"
        [excludeDays]="[0, 6]"
        locale="fr"
        [dayStartHour]="8"
        [dayEndHour]="18"
        (eventClicked)="eventClicked($event)"
        (dayHeaderClicked)="changeViewDay($event)"
        (eventTimesChanged)="eventTimesChanged($event)"
        [refresh] = "refresh"
        [eventTitleTemplate]="customeWeekViewTemplate"
        [snapDraggedEvents]="true"        
        
    ></mwl-calendar-week-view>


    <div *ngIf="!isWeekCalendar"  class="w-full text-center bg-white p-1 text-black hover:bg-gray-200 ps-[70px]" (click)="toggleWeekCalendar()">
        <h2 class="font-bold">{{ viewDate | date:'EEEE' | lowercase }}</h2>
        <h2 class="text-gray-500">{{ viewDate | date:'d MMM' | lowercase }}</h2>
    </div>
    <mwl-calendar-day-view *ngIf="!isWeekCalendar"
    [viewDate]="viewDate"
    

    class="week-view" 
    [events]="events"
    locale="fr"
    [dayStartHour]="8"
    [dayEndHour]="18"
    (eventClicked)="eventClicked($event)"
    (eventTimesChanged)="eventTimesChanged($event)"
    [refresh] = "refresh"
    


    [eventTitleTemplate]="customeWeekViewTemplate"
    
    ></mwl-calendar-day-view>

    <!-- [eventTitleTemplate]="customEWeekViewTemplate">     -->

    <ng-template #customeWeekViewTemplate let-event="event" >
        <div class="titre h-full flex flex-col justify-between relative text-white">
          <div class="item-center text-center">
            <!-- Votre contenu principal ici -->
            <div class="flex flex-row">
                <div class="flex-1 text-start">{{getCourseByEventId(event.id)!.name_salle}}</div>
                <div class="flex-1 text-center font-bold">
                {{ getRessourcesNameByInitial(getCourseByEventId(event.id)!.initial_ressource) }}
                </div>
                <div class="flex-1 text-end">{{ getInitialTeacher(event.id) }}</div>
            </div>
          </div>
          
          <!-- Footer dans la ng-template -->
          <div class="flex flex-row items-center justify-center">
            <img src="assets/images/clock.png" alt="Logo" class="w-[18px]" >
            <h2>{{ getTimeString(getCourseByEventId(event.id)!.start_time) }} - {{ getTimeString(getCourseByEventId(event.id)!.end_time) }} </h2>
          </div>
          
        </div>

      </ng-template>
    </ng-container>
</div>

<ng-container *ngIf="showModalAdd && !loading">
    <course-add [teachers]="teachers" [resources]="ressourcesShow" [salles]="salles" [groupes]="group_show" (courseEvent)="addCourse($event)" (closeModal)="closeModalAdd()"></course-add>
</ng-container> 

<ng-container *ngIf="showModalMod" >
    <course-edit [course]="courseForEdit" [teachers]="teachers" [resources]="ressourcesShow" [salles]="salles" [groupes]="group_show" (courseEvent)="addCourse($event)" (closeModal)="closeModalMod()" (removeEvent)="removeCourse($event)"></course-edit></ng-container>



<ng-container>
    <copy-course [courses]="courses" [displayedDates]="generateWeekDays()" [showModal]="showModalCopy" [showModalPaste]="showModalPaste" [promotion]="promoSelected" (selectedDaysOutput)="onChangeSelectedDays($event)" [selectedDays]="selectedDays" (closeModal)="closeModalCopy()" (closeModalP)="closeModalPaste()" (refresh)="loadEvents()"></copy-course>
</ng-container>

<ng-container *ngIf="showModalStats">
    <stats-teacher [idTeacher]="idUser" (closeModal)="closeModalStats()"></stats-teacher>
</ng-container>